# MySQL索引、事务

## 索引

### 概念

索引是一种特殊的文件，包含着对数据表里所有记录的引用指针。可以对表中的一列或多列创建索引， 并指定索引的类型，各类索引有各自的数据结构实现。

### 索引的作用

就一句话，加快查询数据的速度。

- 数据库中的表、数据、索引之间的关系，类似于书架上的图书、书籍内容和书籍目录的关系。
- 索引所起的作用类似书籍目录，可用于快速定位、检索数据。
- 索引对于提高数据库的性能有很大的帮助。

### 索引使用场景

可以使用explain来进行查看SQL的执行：
要考虑对数据库表的某列或某几列创建索引，需要考虑以下几点：

- 数据量较大，且经常对这些列进行条件查询。
- 该数据库表的插入操作，及对这些列的修改操作频率较低。
- 索引会占用额外的磁盘空间，所以磁盘空间需要充足。(存放在磁盘的.ibd文件里）



满足以上条件时，考虑对表中的这些字段创建索引，以提高查询效率。
反之，如果非条件查询列，或经常做插入、修改操作，或磁盘空间不足时，不考虑创建索引。

### 索引的使用

创建主键约束（PRIMARY KEY）、唯一约束（UNIQUE）、外键约束（FOREIGN KEY）时，会自动创建对应列的索引。

查看索引

> show index from 表名;

创建索引
对于非主键、非唯一约束、非外键的字段，可以创建普通索引

> create index 索引名 on 表名(字段名);

删除索引

> drop index 索引名 on 表名;

索引保存的数据结构主要为B+树，及hash的方式.

## 事务

为什么要使用事务
准备测试表：

> ==drop table if exists accout; create table accout(
> id int primary key auto_increment,
> name varchar(20) comment ‘账户名称’,
> money decimal(11,2) comment ‘金额’
> );
> insert into accout(name, money) values (‘阿里巴巴’, 5000),
> (‘四十大盗’, 1000);



比如说，四十大盗把从阿里巴巴的账户上偷盗了2000元

> – 阿里巴巴账户减少2000
> update accout set money=money-2000 where name = ‘阿里巴巴’;
> – 四十大盗账户增加2000
> update accout set money=money+2000 where name = ‘四十大盗’;

假如在执行以上第一句SQL时，出现网络错误，或是数据库挂掉了，阿里巴巴的账户会减少2000，但是 四十大盗的账户上就没有了增加的金额。那么钱去哪里了呢，不翼而飞了？这时候我们就需要使用事务来控制，保证以上两句SQL要么全部执行成功，要么全部执行失败。

### 事物的概念

事务指逻辑上的一组操作，组成这组操作的各个单元，要么全部成功，要么全部失败。 在不同的环境中，都可以有事务。对应在数据库中，就是数据库事务。

### 事务的使用

事务三板斧

（1）开启事务：start transaction;
（2）执行多条SQL语句
（3）回滚或提交：rollback/commit;
说明：rollback即是全部失败，commit即是全部成功。
举例

> **start transaction;**
> **– 阿里巴巴账户减少2000**
> **update accout set money=money-2000 where name = ‘阿里巴巴’;**
> **– 四十大盗账户增加2000**
> **update accout set money=money+2000 where name = ‘四十大盗’;**
> **commit;**
> 
